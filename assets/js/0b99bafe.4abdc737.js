"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[166],{35318:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>d});var a=r(27378);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),p=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(r),d=n,h=u["".concat(l,".").concat(d)]||u[d]||m[d]||o;return r?a.createElement(h,i(i({ref:t},c),{},{components:r})):a.createElement(h,i({ref:t},c))}));function d(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"},52780:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=r(25773),n=(r(27378),r(35318));const o={title:"ARM is trending! Performance Comparisons among Google, AWS, and Azure",authors:[{name:"Shirui Zhao",title:"Author",url:"https://github.com/soulbird",image_url:"https://github.com/soulbird.png"},{name:"Sylvia",title:"Technical Writer",url:"https://github.com/SylviaBABY",image_url:"https://avatars.githubusercontent.com/u/39793568?v=4"}],keywords:["API gateway","ARM","Azure","AWS","Google","Apache APISIX"],description:"This article uses API Gateway Apache APISIX to compare the performance in ARM among Google, AWS, and Azure in network IO-intensive scenarios.",tags:["Ecosystem"]},i=void 0,s={permalink:"/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix",source:"@site/blog/2022/08/12/arm-performance-google-aws-azure-with-apisix.md",title:"ARM is trending! Performance Comparisons among Google, AWS, and Azure",description:"This article uses API Gateway Apache APISIX to compare the performance in ARM among Google, AWS, and Azure in network IO-intensive scenarios.",date:"2022-08-12T00:00:00.000Z",formattedDate:"August 12, 2022",tags:[{label:"Ecosystem",permalink:"/blog/tags/ecosystem"}],readingTime:6.045,truncated:!0,authors:[{name:"Shirui Zhao",title:"Author",url:"https://github.com/soulbird",image_url:"https://github.com/soulbird.png",imageURL:"https://github.com/soulbird.png"},{name:"Sylvia",title:"Technical Writer",url:"https://github.com/SylviaBABY",image_url:"https://avatars.githubusercontent.com/u/39793568?v=4",imageURL:"https://avatars.githubusercontent.com/u/39793568?v=4"}],prevItem:{title:"Backend-for-Frontend: the demo",permalink:"/blog/2022/08/17/backend-for-frontend-demo"},nextItem:{title:"Biweekly Report (Jul 16 - Jul 31)",permalink:"/blog/2022/08/09/weekly-report-0731"}},l={authorsImageUrls:[void 0,void 0]},p=[{value:"Background",id:"background",children:[{value:"AWS Graviton",id:"aws-graviton",children:[],level:3},{value:"Google Cloud Platform T2A",id:"google-cloud-platform-t2a",children:[],level:3},{value:"Azure Arm-based Virtual Machines",id:"azure-arm-based-virtual-machines",children:[],level:3}],level:2},{value:"Three cloud vendors ARM server performance test",id:"three-cloud-vendors-arm-server-performance-test",children:[{value:"Test case",id:"test-case",children:[],level:3},{value:"Test Results",id:"test-results",children:[],level:3}],level:2},{value:"Cost-performance comparison",id:"cost-performance-comparison",children:[],level:2},{value:"Summary",id:"summary",children:[],level:2},{value:"Reference",id:"reference",children:[],level:2}],c={toc:p};function m(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"This article uses API Gateway Apache APISIX to compare the performance in ARM among Google, AWS, and Azure in network IO-intensive scenarios.")),(0,n.kt)("head",null,(0,n.kt)("link",{rel:"canonical",href:"https://api7.ai/2022/08/12/arm-performance-google-aws-azure-with-apisix/"})),(0,n.kt)("h2",{id:"background"},"Background"),(0,n.kt)("p",null,"The ARM architecture belongs to the ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Reduced_instruction_set_computer"},"RISC"),". The RISC microprocessor architecture design uses a highly optimized set of instructions to enable small processors to efficiently handle complex tasks."),(0,n.kt)("p",null,"ARM has become the cornerstone of the world's largest computing ecosystem and mobile devices, and is considered by many experts to be the future of cloud computing due to its low power consumption, flexible licensing and low cost."),(0,n.kt)("p",null,"Therefore, mainstream cloud vendors led by AWS, Google Cloud Platform (GCP) and Azure have successively launched servers with ARM architecture. Among them, AWS launched the first server processor AWS Graviton based on ARM architecture in 2018."),(0,n.kt)("h3",{id:"aws-graviton"},"AWS Graviton"),(0,n.kt)("p",null,"AWS Graviton is a series of server processors based on the ",(0,n.kt)("a",{parentName:"p",href:"https://www.arm.com/"},"ARM architecture")," released by AWS in 2018. The first generation of AWS Graviton processors uses custom chips and 64-bit Neoverse cores."),(0,n.kt)("p",null,"Released in 2020, AWS Graviton2 processors represent a major leap forward in performance and functionality compared to first-generation AWS Graviton processors. 7x faster performance, 4x more cores, 2x cache, 5x faster memory, and more."),(0,n.kt)("p",null,"The latest AWS Graviton3 processors to be released at the end of May 2022 are based on the more advanced ",(0,n.kt)("a",{parentName:"p",href:"https://www.arm.com/zh-TW/products/silicon-ip-cpu/neoverse/neoverse-v1"},"Neoverse V1")," design, they offer up to twice the floating point performance, twice the cryptographic performance, and three times the ML compared to the AWS Graviton2 processors performance, including support for bfloat16. The following figure shows the main models equipped with AWS Graviton3 processors:"),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0812/1.png",alt:"AWS Graviton3 processors"})),(0,n.kt)("h3",{id:"google-cloud-platform-t2a"},"Google Cloud Platform T2A"),(0,n.kt)("p",null,"The Google Cloud Platform(GCP) Tau T2A VM is a preview of Google's first ARM-based virtual machine in July 2022, powered by Ampere\xae Altra\xae Arm processors based on the Neoverse N1 design. Tau T2A VMs come in a variety of predefined VM shapes with up to 48 vCPUs per VM and 4GB of memory per vCPU."),(0,n.kt)("p",null,"They offer up to 32 Gbps of network bandwidth and a wide range of network-attached storage options, making the Tau T2A VM suitable for scale-out workloads including web servers, containerized microservices, data record processing, media transcoding, and Java applications. The main models are as follows:"),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0812/2.png",alt:"Tau T2A VM"})),(0,n.kt)("h3",{id:"azure-arm-based-virtual-machines"},"Azure Arm-based Virtual Machines"),(0,n.kt)("p",null,"In April, Microsoft announced a preview of its family of Azure virtual machines based on Ampere\xae Altra\xae Arm processors. The new VMs are designed to efficiently run scale-out workloads, web servers, application servers, open source databases, cloud-native and rich .NET applications, Java applications, game servers, media servers, and more. The new VM series includes general Dpsv5 and memory-optimized Epsv5 VMs. The main models are as follows:"),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0812/3.png",alt:"Dpsv5 and Epsv5 VMs"})),(0,n.kt)("h2",{id:"three-cloud-vendors-arm-server-performance-test"},"Three cloud vendors ARM server performance test"),(0,n.kt)("p",null,"In this article, we will reflect the overall performance of each server by testing single-core performance. Here, the network IO-intensive API gateway Apache APISIX is selected to bind a single CPU core for stress testing on three models: AWS c7g.large, GCP t2a-standard-2 and Azure D2ps v5 (belonging to the Dpsv5-series, dual-core CPU), and analyze the performance of the server through the two indicators of QPS and response delay."),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix"},"Apache APISIX")," is a cloud-native, high-performance, scalable API gateway. Based on NGNIX + LuaJIT and etcd, APISIX has the characteristics of dynamic routing and plug-in hot loading compared with traditional API gateways, which is especially suitable for API management under cloud native architecture."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0812/4.png",alt:"Apache APISIX"})),(0,n.kt)("p",null,"Next, we will use the APISIX official open source performance ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/apache/apisix/blob/master/benchmark/run.sh"},"test script for testing"),"."),(0,n.kt)("h3",{id:"test-case"},"Test case"),(0,n.kt)("p",null,"We will test the performance of Apache APISIX under two typical scenarios in order to obtain more realistic and rich test data:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Scenario 1: Single upstream.")," In this scenario, a single upstream (without any plugins) is used to test the performance of APISIX in pure proxy back-to-origin mode.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Scenario 2: Single upstream + multiple plugins.")," This scenario uses a single upstream with multiple plugins and two plugins are used here. It mainly tests the performance of APISIX when the two core consumption performance plugins, ",(0,n.kt)("inlineCode",{parentName:"p"},"limit-count")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"prometheus"),", are enabled."))),(0,n.kt)("h3",{id:"test-results"},"Test Results"),(0,n.kt)("p",null,"The figure below is the QPS (queries per second) test result and the higher the number, the better the performance."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0812/5.png",alt:"QPS result"})),(0,n.kt)("p",null,"The figure below is the response delay test results in milliseconds. The smaller the number, the better the performance."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://static.apiseven.com/2022/blog/0812/6.png",alt:"Response delay results"})),(0,n.kt)("p",null,"From the perspective of QPS and response delay, under network IO-intensive API gateways like Apache APISIX, AWS C7g has a 100% performance improvement compared to GCP T2A, and Azure Dpsv5 has a performance lead of about 15% compared to GCP T2A."),(0,n.kt)("h2",{id:"cost-performance-comparison"},"Cost-performance comparison"),(0,n.kt)("p",null,'Since this article only focuses on testing the performance of ARM machines from different cloud vendors, so we will ignore the change of "the same number of CPU cores with different memory", and analyze the cost-performance ratio of AWS Graviton3 and GCP T2A only from the perspective of the number of CPU cores.'),(0,n.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,n.kt)("div",{parentName:"div",className:"admonition-heading"},(0,n.kt)("h5",{parentName:"div"},(0,n.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,n.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,n.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,n.kt)("div",{parentName:"div",className:"admonition-content"},(0,n.kt)("p",{parentName:"div"},"In the current test scenario, the cost-performance ratio can be understood as: QPS/cost."))),(0,n.kt)("p",null,"The table below compares server hourly prices for different cores for AWS C7g (US East Ohio), GCP T2A (us-central1) and Azure Dpsv5 (East US):"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"VM series / vCPU"),(0,n.kt)("th",{parentName:"tr",align:null},"1"),(0,n.kt)("th",{parentName:"tr",align:null},"2"),(0,n.kt)("th",{parentName:"tr",align:"left"},"4"),(0,n.kt)("th",{parentName:"tr",align:"left"},"8"),(0,n.kt)("th",{parentName:"tr",align:"left"},"16"),(0,n.kt)("th",{parentName:"tr",align:"left"},"32"),(0,n.kt)("th",{parentName:"tr",align:"left"},"64"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"AWS C7g"),(0,n.kt)("td",{parentName:"tr",align:null},"$0.0361"),(0,n.kt)("td",{parentName:"tr",align:null},"$0.0723"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.1445"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.289"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.5781"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$1.1562"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$1.7342")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"GCP T2A"),(0,n.kt)("td",{parentName:"tr",align:null},"$0.0385"),(0,n.kt)("td",{parentName:"tr",align:null},"$0.077"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.154"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.308"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.616"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$1.232"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$1.848")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Azure Dpsv5"),(0,n.kt)("td",{parentName:"tr",align:null},"*"),(0,n.kt)("td",{parentName:"tr",align:null},"$0.077"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.154"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.308"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$0.616"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$1.232"),(0,n.kt)("td",{parentName:"tr",align:"left"},"$1.848")))),(0,n.kt)("p",null,"The following table summarizes the cost and cost\u2013performance ratio of AWS c7g.large and GCP t2a-standard-2 running for one year, referring to the QPS data for a single upstream in the Apache APISIX performance test. The larger the number, the higher the QPS can be obtained at the unit price."),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null}),(0,n.kt)("th",{parentName:"tr",align:null},"Annual cost"),(0,n.kt)("th",{parentName:"tr",align:null},"Cost performance (QPS/cost)"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"AWS c7g.large"),(0,n.kt)("td",{parentName:"tr",align:null},"$633.3"),(0,n.kt)("td",{parentName:"tr",align:null},"36.3")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"GCP t2a-standard-2"),(0,n.kt)("td",{parentName:"tr",align:null},"$674.5"),(0,n.kt)("td",{parentName:"tr",align:null},"16.8")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Azure D2ps v5"),(0,n.kt)("td",{parentName:"tr",align:null},"$398.0\uff0841% off)"),(0,n.kt)("td",{parentName:"tr",align:null},"33.6")))),(0,n.kt)("p",null,"From the test results, AWS C7g is more cost-effective than GCP T2A and Azure Dpsv5. Although Azure Dpsv5 has only a 15% performance improvement compared to GCP T2A, the cost performance is nearly double."),(0,n.kt)("h2",{id:"summary"},"Summary"),(0,n.kt)("p",null,"AWS launched the first ARM-based processor, AWS Graviton, in 2018. It was about 4 years ahead of GCP for the deployment of the ARM-based server field. Now the AWS Graviton processor has developed to the third generation."),(0,n.kt)("p",null,"Through the performance test results and price\u2013performance ratio analysis of Apache APISIX, we can see that AWS Graviton3 has higher performance and cost-effective than GCP T2A and Azure Dpsv5. This is inseparable from the fact that AWS has been deeply involved in the field of ARM-based servers for many years."),(0,n.kt)("p",null,"In addition, we used Apache APISIX bound single-core tests during our testing, and the price-performance ratio of AWS Graviton 3 may be further improved if multiple cores are used."),(0,n.kt)("h2",{id:"reference"},"Reference"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://aws.amazon.com/cn/blogs/aws/new-amazon-ec2-c7g-instances-powered-by-aws-graviton3-processors/"},"New \u2013 Amazon EC2 C7g Instances, Powered by AWS Graviton3 Processors")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://cloud.google.com/compute/docs/general-purpose-machines#t2a_machines"},"Tau T2A machine series (Preview)")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://azure.microsoft.com/en-us/blog/now-in-preview-azure-virtual-machines-with-ampere-altra-armbased-processors/"},"Now in preview: Azure Virtual Machines with Ampere Altra Arm-based processors"))))}m.isMDXComponent=!0}}]);